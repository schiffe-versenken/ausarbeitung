% !TeX document-id = {88ddee8b-8eb6-46e0-9af4-2c10d8b61c04}
% !TeX spellcheck = de-DE
% !TeX encoding = utf8
% !TeX TXS-program:compile = txs:///pdflatex/[--shell-escape]

% This is LLNCS.DEM the demonstration file of
% the LaTeX macro package from Springer-Verlag
\documentclass[a4paper,12pt]{llncs}
%
\usepackage{makeidx}  % allows for indexgeneration
\makeindex

\usepackage[ngerman]{babel}
\usepackage[utf8]{inputenc}      % Code-Page latin 1
\usepackage[T1]{fontenc}
% Nur eine der beiden folgenden Zeilen einbinden!
% siehe Abschnitt Bilder
%\usepackage{graphicx}       % Bilder einbinden, Version fuer normales latex
\usepackage[pdftex]{graphicx}       % Bilder einbinden, Version fuer pdflatex

% mit Hyperrefs
\usepackage[pdftex, plainpages=false,hypertexnames=true,pdfnewwindow=true,backref=true,colorlinks=true,citecolor=blue,linkcolor=black,urlcolor=blue,filecolor=blue]{hyperref}% 
% weitere Packages
\usepackage{ifthen}                 % Zum Auskommentieren von Textteilen
\usepackage{amssymb}                % Mathematische Buchstaben
\usepackage{amsmath}                % Verbesserter Formelsatz
\usepackage[vlined,boxed]{algorithm2e}
\usepackage{booktabs}               % schönere Tabellen
\usepackage{color}
\usepackage{hyperref}
 \hypersetup{urlcolor=black,citecolor=black}

%\setalcapskip{1.5ex} % fuer package algorithm
\usepackage{dsfont}  
%\newtheorem{definition}{Definition}
\usepackage{doc}
\usepackage{mathrsfs}
%TODO Die nächsten Zeilen sollten in der finalen Version deaktiviert werden.
\usepackage[local,grumpy,dirty={, geändert}]{gitinfo2}
\usepackage{mathtools}
\usepackage{todonotes}

% Seitenformat ===============================================================
\hoffset=-1.25truecm
\setlength{\topmargin}{0.0cm}
\setlength{\textheight}{23.0cm}
\setlength{\footskip}{1.5cm}
\setlength{\textwidth}{15.4cm}
\setlength{\evensidemargin}{1.5cm}
\setlength{\oddsidemargin}{1.5cm}
\setlength{\parskip}{1ex}
\setlength{\parindent}{0pt}
\setlength{\marginparwidth}{1.4cm}
\setlength{\marginparsep}{1mm}

\pagestyle{plain}

% Makro-Definitionen ==========================================================

% 
\def\myverzeichnis{.}

\numberwithin{equation}{section} 
% Bild -----------------------------------------------------------------------
% #1 Filename;  #2 Label;  #3 Bildunterschrift;  #4 Kurzform
\newcommand{\bild}[4]{
  \begin{figure}[htbp]
    \begin{center}
      \includegraphics{#1}
      \caption[#4]{#3}
      \label{#2}
    \end{center}
  \end{figure}
}

% Bildbreite -----------------------------------------------------------------
% #1 Filename;  #2 Breite;  #3 Label;  #4 Bildunterschrift;  #5 Kurzform
\newcommand{\bildbreite}[5]{
  \begin{figure}[htbp]
    \begin{center}
      \includegraphics[width=#2]{#1}
      \caption[#5]{#4}
      \label{#3}
    \end{center}
  \end{figure}
}

\newtheorem{satz}{Satz}
\newtheorem{korollar}{Korollar}

\DeclareMathOperator{\hit}{hit}
\DeclareMathOperator{\shot_count}{shot\_count}
\DeclareMathOperator{\strat}{strat}
\DeclareMathOperator{\strategies}{strategies}
\DeclareMathOperator{\finished}{finished}


% ============================================================================
\begin{document}

% =========== Das war der Vorspann, jetzt geht's los! ========================

% ============================================================================
% =============  AB HIER DARF UND SOLL GETIPPT WERDEN ========================
% ============================================================================
\author{Viel Schreiber}
\index{Viel Schreiber}

% Das Institut wird fuer den Betreuer missbraucht ...
\institute{{\bf Betreuer:} Dipl.-Inf. Carl Coder}
\authorrunning{Viel Schreiber}
\title{Meine Seminarausarbeitung}

\maketitle

%\todo[inline]{Version \gitAbbrevHash, Branch \gitBranch, \gitCommitterIsoDate \gitDirty}

\thispagestyle{empty}

\begin{abstract}
Ein schöner Abstract. Das ist einfach die Kurzzusammenfassung.
\end{abstract}

[Christopher]

% Einleitung -----------------------------------------------------------------
\section{Einleitung}

\subsection{Spielbeschreibung}
Diese Ausarbeitung beschäftigt sich mit der Umsetzung von Schiffe-Versenken in beliebig viele Dimensionen.
Die generelle Funktionsweise von dem normalen Schiffe-Versenken bleibt erhalten, muss jedoch um einige Dinge erweitert werden, um auch in höheren Dimensionen gut spielbar zu sein.

Wir betrachten das Spielgeschehen zur Einfachheit halber nur aus der Sicht eines Spielers.
Zu Beginn platziert der Gegner eine beliebige Anzahl an Schiffen auf seinem Spielfeld. Es wird davon ausgegangen, dass die Schiffspositionen rein zufällig ausgewählt wurden, d.h. dass zu Spielbeginn eine Flotte aus der Menge aller möglichen Flotten ausgewählt wird. Jede mögliche Flotte hat hierbei die gleiche Wahrscheinlichkeit, ausgewählt zu werden.
Natürlich sind die Schiffspositionen dem Spieler nicht bekannt.
Die Gesamtheit aller gewählten Schiffspositionen wird auch die Flotte genannt.
Nun kann der Spieler anfangen, auf bestimmte Positionen auf dem Spielfeld, auch Zellen genannt, zu schießen.
Da Schiffe überlappen können, können mit jedem Schuss mehrere Schiffe, also Teilmengen der Flotte getroffen werden.
Nach jedem Schuss erfährt der Spieler von seinem Gegner, welche Teilmenge der Flotte er getroffenen hat.
Falls keine Schiffe getroffen wurden ist diese Menge natürlich leer.
Ein Schiff gilt als versenkt, sobald es getroffen wurde.
Sobald alle Schiffe versenkt wurden, ist das Spiel beendet.

Das Ziel des Spielers ist es, mit möglichst wenig Schüssen alle Schiffe zu versenken.

\section{Formalisierung des Spielprinzips}

\begin{definition}
Sei
\[
C_{all} \coloneqq \{1, \dots, N\}^d
\]
die Menge aller Zellen des Spielfeldes mit jeweils $N$ Zellen in $d$ Dimensionen.
\end{definition}

\begin{satz}
Dann gilt:
\[
|C_{all}|=N^d
\]
\end{satz}

\begin{proof}
\end{proof}

\begin{definition}
Seien $c, c' \in C_{all}$ Zellen.
Dann ist
\[
c \leq c' \Leftrightarrow \forall i \in \{1, \dots, d\} \colon c_{i} \leq c'_{i} 
\]
\end{definition}

\begin{definition}
Sei $c_{min} \in C_{all}$ und $c_{max} \in C_{all}$ mit $c_{min} \leq c_{max}$.
\[
l=(c_{min}, c_{max})
\]
eine mögliche Schiffsposition (location), welche mithilfe einer minimalen Ecke $c_{min}$ und einer maximalen Ecke $c_{max}$ bestimmt wird.
\end{definition}

\begin{definition}
Sei 
\[
L_{all} \coloneqq
\{
(i, j) \in C_{all} \times C_{all}
\mid
i \leq j
\}
\] die Menge aller möglichen Schiffspositionen.
\end{definition}

\begin{satz}
Dann gilt:
\[
|L_{all}|=\left(\frac{(N+1) N}{2}\right)^d
\]
\end{satz}

\begin{definition}
Sei 
\[
K \coloneqq \{1, \dots, |L_{all}|\}
\]
die Menge aller möglichen Flottengrößen.
\end{definition}

\begin{definition}
Sei $k \in K$ die Größe der Flotte.
Dann ist
\[
F_{all}(k) \coloneqq\{F \in P(L_{all}) \mid |F| = k\}
\]
die Menge aller Flotten der Größe $k$.
\end{definition}

\begin{satz}
Sei $k \in K$ die Größe der Flotte.
Dann gilt:
\[
|F_{all}(k)|=\binom{|L_{all}|}{k}
\]
\end{satz}

\begin{proof}
\end{proof}

\begin{definition}
Dann ist
\[
F_{all} \coloneqq \bigcup_{k=1}^{|L_{all}|} F_{all}(k)
\]
\end{definition}

\begin{satz}
Dann gilt:
\[
|F_{all}|=2^{|L_{all}|} - 1
\]
\end{satz}

\begin{proof}
\begin{align}
\begin{split}
&|F_{all}|=\sum_{k=1}^{|L_{all}|} |F_{all}(k)|\\
=&\sum_{k=1}^{|L_{all}|} \binom{|L_{all}|}{k} \\
=&\left( \sum_{k=0}^{|L_{all}|} \binom{|L_{all}|}{k} \right) - 1 \\
=&2^{|L_{all}|} - 1
\end{split}
\end{align}
\qed
\end{proof}


\begin{definition}
Sei $F \in F_{all}$ und $c \in C_{all}$.
Dann ist 
\begin{align}
&\hit:F_{all} \times C_{all} \rightarrow L_{all} \quad mit \nonumber\\
&\hit(F, c)\mapsto \{(c_{min}, c_{max}) \in F \mid c_{min} \leq c \leq c_{max}\} \nonumber
\end{align}
die Treffer-Funktion, welche angibt, welche Schiffe bei einem Schuss auf Zelle $c$ getroffen wurden, falls $F$ die vom Gegner platzierte Flotte ist. In anderen Worten, die Menge der Schiffe aus Flotte $F$, die die Zelle $c$ belegen.
\end{definition}

\subsection{Schuss-Strategien}

\begin{definition}
Eine Funktion der Form
\begin{align}
&\strat:P(C_{all}) \rightarrow C_{all} \nonumber
\end{align}
wird Strategiefunktion genannt. Diese wählt die nächste Zelle aus, auf die geschossen werden soll, abhängig davon, auf welche Zellen bereits geschossen wurden.
\end{definition}

\begin{definition}
Sei
\[
\strategies  \coloneqq \{ \strat:P(C_{all}) \rightarrow C_{all} \}
\]
die Menge an allen Strategiefunktionen.
\end{definition}

\begin{definition}
Sei $F\in F_{all}$ die gewählte Flotte und $S \in P(C_{all})$ die Menge an bereits beschossenen Zellen.
Dann ist:
\[
\finished(F, S) \Leftrightarrow \bigcup_{c \in S} \hit(F, c) = F
\]
wahr, falls alle Schiffe aus der Flotte $F$ versenkt wurden.
\end{definition}


\begin{definition}
Sei $F\in F_{all}$ die gewählte Flotte und $S$ die Menge an bereits beschossenen Zellen.
Sei außerdem $\strat \in \strategies$ die verwendete Schuss-Strategie.
Dann ist
\begin{align}
&\shot_count(F, S, \strat)=
& \begin{cases} 
  	0& ,\finished(F, S) \\
      \shot_count(F, S \cup \strat(S), \strat) + 1 & ,sonst
   \end{cases}
\nonumber
\end{align}
die Anzahl an Schüssen, die benötigt werden, um alle Schiffe der Flotte $F$ mit der Schuss-Strategiefunktion $\strat$ zu versenken, falls bereits auf die Zellen der Menge $S$ geschossen wurde.

Außerdem ist dann
\begin{align}
&\shot_count(F, \strat)=\shot_count(F, \emptyset, \strat)
\nonumber
\end{align}
die Anzahl an Schüssen, die benötigt werden, um alle Schiffe der Flotte $F$ mit der Schuss-Strategiefunktion $\strat$ zu versenken.
\end{definition}

\subsection{Zufallsvariablen}

\begin{definition}
Sei $G_{all} \subseteq F_{all}$ eine Menge an Flotten.
\end{definition}

\begin{definition}
Sei $G_a \in G_{all} $ eine zufällig usgewählte Flotte aus $G_{all} $. Im folgenden wird davon ausgegangen, dass $G_a$ für den Spieler unbekannt ist.
Dann gilt:
\[
P(G = choose(G_{all})) = \frac{1}{|G_{all}|}
\]
In anderen Worten, alle Flotten haben die gleiche Wahrscheinlichkeit, ausgewählt zu werden, d.h. sie sind gleichverteilt.
\end{definition}

\begin{definition}
Sei $\strat \in \strategies$ die verwendete Schuss-Strategie.
Sei $G_a \in G_{all}$ die ausgewählte Flotte aus $G_{all}$.
Dann ist
\begin{align}
T_{\strat,G_{all}} \coloneqq \shot_count(choose(G_{all}), \strat)
\nonumber
\end{align}
eine Zufallsvariable, die die Anzahl an Schüssen zum versenken einer beliebig gewählten Flotte aus der Menge $G_{all}$.
\end{definition}

\subsection{Erwartungswerte}

\begin{satz}
Sei $\strat \in \strategies$ die verwendete Schuss-Strategie.
Dann ist
\begin{align}
E(T_{\strat, G_{all}})=\frac{1}{|G_{all}|} \sum_{G \in G_{all}} \shot_count(G, \strat)
\nonumber
\end{align}
der Erwartungswert von $T_{\strat, G_{all}}$.
\end{satz}

\begin{proof}
\begin{align}
\begin{split}
E(T_{\strat,G_{all}})&=\sum_{G \in G_{all}} P(G = choose(G_{all})) \shot_count(G, \strat)\\
&=\frac{1}{|G_{all}|} \sum_{G \in F_{all}} \shot_count(G, \strat)
\nonumber
\end{split}
\end{align}
\qed
\end{proof}

\begin{satz}
Sei $\strat \in \strategies$ die verwendete Schuss-Strategie.
Dann ist
\begin{align}
E(T_{\strat,F_{all}})=\frac{1}{|F_{all}|} \sum_{k=1}^{|L_{all}|}\sum_{F\in F_{all}(k)} \shot_count(F, \strat)
\nonumber
\end{align}
der Erwartungswert von $T_{\strat}$.
\end{satz}

\begin{proof}
\begin{align}
\begin{split}
&E(T_{\strat,F_{all}})\\
=&\frac{1}{|F_{all}|} \sum_{F\in F_{all}} \shot_count(F, \strat)\\
=&\frac{1}{|F_{all}|} \sum_{k=1}^{|L_{all}|}\sum_{F\in F_{all}(k)} \shot_count(F, \strat)
\nonumber
\end{split}
\end{align}
\qed
\end{proof}

\begin{definition}
Sei $k \in N$ die Flottengröße.
Dann ist
\[
g_k=\frac{|F_{all}(k)|}{|F_{all}|}=\frac{\binom{|L_{all}|}{k}}{2^{|L_{all}|} - 1}
\]
der Anteil an Flotten der Größe $k$ an der Menge aller Flotten. Dieser Faktor wird später als Gewichtungsfaktor für den Erwartungswert der Flottengröße $k$ verwendet.
\end{definition}

\begin{satz}
Sei $\strat \in \strategies$ die verwendete Schuss-Strategie.
Dann ist
\begin{align}
E(T_{\strat,F_{all}})=\sum_{k=1}^{|L_{all}|} g_k E(T_{\strat,F_{all}(k)})
\nonumber
\end{align}
der Erwartungswert von $T_{\strat,F_{all}}$.
\end{satz}


\subsection{Das Gesetz der großen Zahlen}

\begin{definition}
Sei im folgenden Abschnitt $\epsilon \in R_+$ die obere Grenze für die akzeptierte Abweichung des errechneten Erwartungswertes vom tatsächlichen Erwartungswert.

Sei im folgenden Abschnitt $\eta \in (0,1]$ die untere Grenze für die akzeptierte Wahrscheinlichkeit, dass Abweichung des errechneten Erwartungswertes kleiner als $\epsilon$ ist. 
\end{definition}

\begin{satz}
Sei $\epsilon > 0$ und $F_{sub,k} \subseteq F_{all}(k)$ eine Menge an Flotten der Größe $k$.
Dann gilt nach dem schwachen Gesetz der großen Zahlen:
\begin{align}
P(|E(T_{\strat,F_{sub,k}}) - E(T_{\strat,F_{all}(k)})| \geq \epsilon) \leq \frac{V(T_{\strat,F_{sub,k}})}{|F_{sub,k}| \epsilon^2}
\nonumber
\end{align}
\end{satz}

Diese Aussage kann folgendermaßen umgeformt werden:

\begin{satz}
Sei $F_{sub,k} \subseteq F_{all}(k)$ eine Menge an Flotten der Größe $k$.
Dann gilt:
\begin{align}
P(|E(T_{\strat,F_{sub,k}}) - E(T_{\strat,F_{all}(k)})| < \epsilon) \geq 1 - \frac{V(T_{\strat,F_{sub,k}})}{|F_{sub,k}| \epsilon^2}
\nonumber
\end{align}
\end{satz}

\begin{proof}
\begin{align}
\begin{split}
&P(|E(T_{\strat,F_{sub,k}}) - E(T_{\strat,F_{all}(k)})| \geq \epsilon) \leq \frac{V(T_{\strat,F_{sub,k}})}{|F_{sub,k}| \epsilon^2}\\
\Leftrightarrow &1 - P(|E(T_{\strat,F_{sub,k}}) - E(T_{\strat,F_{all}(k)})| < \epsilon) \leq \frac{V(T_{\strat,F_{sub,k}})}{|F_{sub,k}| \epsilon^2}\\
\Leftrightarrow &P(|E(T_{\strat,F_{sub,k}}) - E(T_{\strat,F_{all}(k)})| < \epsilon) \geq 1 - \frac{V(T_{\strat,F_{sub,k}})}{|F_{sub,k}| \epsilon^2}\\
\end{split}
\end{align}
\qed
\end{proof}

\begin{satz}
Damit kann dann eine Abbruchbedingung formuliert werden, welche festlegt, ab wann der mit $F_{sub,k}$ berechnete Erwartungswert für uns gut genug ist:

\begin{align}
\frac{V(T_{\strat,F_{sub,k}})}{|F_{sub,k}| \epsilon^2} \geq 1 - \eta \Leftrightarrow P(|E(T_{\strat,F_{sub,k}}) - E(T_{\strat,F_{all}(k)})| < \epsilon) \geq \eta
\nonumber
\end{align}
\end{satz}

\section{Implementation eines Monte-Carlo Algorithmus}

Um zu bewerten, wie gut eine Strategiefunktion $\strat$ abschneidet, kann ein Monte-Carlo Algorithmus implementiert werden, der mit einer gewissen Wahrscheinlichkeit und Genauigkeit den Wert von $E(T_{\strat,F_{all}(k)})$ abschätzt.

Um den Wert von $\shot_count(F, \strat)$ für eine gegebene Flotte $F$ zu berechnen, kann folgende Funktion verwendet werden:

\begin{algorithm}[H]
 function shot\_count(F, strat):\\
 $S=\emptyset$\;
 $\shot_count=0$\;
 \While{$\neg \finished(F, S)$}{
  $next\_target=\strat(S)$\;
  $S=S \cup \hit(F, next\_target)$\;
  $\shot_count=\shot_count+1$\;
 }
  \Return $\shot_count$\;
\end{algorithm}

Dann kann eine Funktion implementiert werden, die den Wert von $E(T_{\strat,F_{all}(k)})$ näherungsweise berechnet. Da es sehr viele Flotten gibt, werden nur so viele Flotten aus dieser Menge ausgewertet, bis der berechnete Wert für uns genau genug ist. Dafür wird in jedem Durchlauf der Teilmenge $F_{sub,k}$ eine weitere zufällige Flotte der Größe $k$ hinzugefügt und danach überprüft, ob die vorher definierte Abbruchbedingung
\[
\frac{V(T_{\strat,F_{sub,k}})}{|F_{sub,k}| \epsilon^2} \geq 1 - \eta
\]
erfüllt ist:

\begin{algorithm}[H]
 function simulate\_rounds(k, strat, $\epsilon, \eta$):\\
 $sum=0$\;
 $q\_sum=0$\;
   $E=0$\;
   $V=0$\;
    $rounds =0$\;
 \While{$true$}{
   $count += shot\_count(generate\_random\_fleet(k), \strat)$\;
   $sum += count$\; 
   $q\_sum += {count}^2$\;
   $E =sum / rounds$\;
   $V =(q\_sum / rounds) - E^2$\;
     \If {$V / (rounds * \epsilon^2) \geq 1 - \eta$}{
     break\;
   }
 }
 \Return $E$\;
\end{algorithm}

Abschliessend kann dann die Funktion implementiert werden, die den Wert von $E(T_{\strat,F_{all}})$ für Flotten beliebiger Größe berechnet. Dafür müssen die Werte für jedes $k$ gewichtet aufsummiert werden. Nebenbei werden auch die Erwartungswerte für jedes $k$ gespeichert, damit diese später auch untersucht werden können.

\begin{algorithm}[H]
 function calculate\_expected\_shot\_count(strat, $\epsilon, \eta$):\\
 $expected\_shot\_count=[]$\;
 $total\_expected\_shot\_count=0$\;
 \For{$k=1,\dots, |L_{all}|$}{
 $(E,V)=simulate\_rounds(k, strat, \epsilon, \eta)$\;
 $expected\_shot\_count[k] = E$\;
 $g_k=\frac{|F_{all}(k)|}{|F_{all}|}$\;
  $total\_expected\_shot\_count+=g_k * E$\;
 }
\end{algorithm}

% Literaturverzeichnis ------------------------------------------------
\newpage
\bibliographystyle{alphadinLinkLocal}
\bibliography{literatur} 

%\iffalse
\end{document}
%\fi
